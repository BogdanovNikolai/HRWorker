# Расширенная функциональность поиска резюме

## Обзор

Мы дополнили форму поиска и логику поиска в нашем API, чтобы полностью дублировать функциональность поиска резюме как у HeadHunter. Теперь система поддерживает все основные параметры поиска, доступные в HH API.

## Новые возможности

### 1. Текстовый поиск

#### Основные параметры
- **keywords** - Поисковая фраза (обязательный параметр)
- **text_logic** - Логика поиска:
  - `all` - Все слова встречаются
  - `any` - Любое из слов встречается
  - `phrase` - Точная фраза встречается
  - `except` - Не встречаются
- **text_field** - Поле поиска:
  - `everywhere` - Везде
  - `title` - В названии резюме
  - `education` - В образовании
  - `skills` - В ключевых навыках
  - `experience` - В опыте работы
  - `experience_company` - В компаниях и отраслях
  - `experience_position` - В должностях
  - `experience_description` - В обязанностях
- **text_period** - Период опыта работы (для text.field = experience*)

### 2. Фильтры по зарплате

- **salary_from** - Нижняя граница зарплаты
- **salary_to** - Верхняя граница зарплаты
- **currency** - Валюта (RUR, USD, EUR)
- **label: only_with_salary** - Только резюме с указанной зарплатой

### 3. Фильтры по опыту и образованию

- **experience** - Опыт работы (множественный выбор):
  - `noExperience` - Нет опыта
  - `between1And3` - От 1 года до 3 лет
  - `between3And6` - От 3 до 6 лет
  - `moreThan6` - Более 6 лет

- **education_levels** - Уровень образования (множественный выбор):
  - `secondary` - Среднее
  - `special_secondary` - Среднее специальное
  - `unfinished_higher` - Неоконченное высшее
  - `higher` - Высшее
  - `bachelor` - Бакалавр
  - `master` - Магистр
  - `candidate` - Кандидат наук
  - `doctor` - Доктор наук

### 4. Фильтры по занятости

- **employment** - Тип занятости (множественный выбор):
  - `full` - Полная занятость
  - `part` - Частичная занятость
  - `project` - Проектная работа
  - `volunteer` - Волонтерство
  - `probation` - Стажировка

- **schedule** - График работы (множественный выбор):
  - `fullDay` - Полный день
  - `shift` - Сменный график
  - `flexible` - Гибкий график
  - `remote` - Удаленная работа
  - `flyInFlyOut` - Вахтовый метод

### 5. Демографические фильтры

- **age_from** - Возраст от
- **age_to** - Возраст до
- **gender** - Пол:
  - `male` - Мужской
  - `female` - Женский

### 6. Статус поиска работы

- **job_search_status** - Статус поиска работы (множественный выбор):
  - `active_search` - Активно ищет работу
  - `looking_for_offers` - Рассматривает предложения
  - `not_looking_for_job` - Не ищет работу
  - `has_job_offer` - Предложили работу, решает
  - `accepted_job_offer` - Вышел на новое место

### 7. Фильтры по датам

- **period** - Период публикации в днях
- **date_from** - Дата публикации от (YYYY-MM-DD)
- **date_to** - Дата публикации до (YYYY-MM-DD)

### 8. Параметры переезда

- **relocation** - Готовность к переезду:
  - `living_or_relocation` - Живут в регионе или готовы переехать
  - `living` - Живут в регионе
  - `living_but_relocation` - Живут в регионе и готовы к переезду
  - `relocation` - Не живут в регионе, но готовы переехать

### 9. Сортировка

- **order_by** - Сортировка результатов:
  - `relevance` - По соответствию
  - `publication_time` - По дате изменения
  - `salary_desc` - По убыванию зарплаты
  - `salary_asc` - По возрастанию зарплаты

### 10. Дополнительные метки

- **label** - Дополнительные фильтры (множественный выбор):
  - `only_with_photo` - Только с фотографией
  - `only_with_salary` - Только с указанной зарплатой
  - `only_with_age` - Только с указанным возрастом
  - `only_with_gender` - Только с указанным полом
  - `only_with_vehicle` - Есть личный автомобиль
  - `exclude_viewed_by_user_id` - Скрыть просмотренные мной
  - `exclude_viewed_by_employer_id` - Скрыть просмотренные компанией

## Пагинация

- **page** - Номер страницы (считается от 0)
- **per_page** - Количество элементов на странице (максимум 100)
- **total** - Общее количество резюме для загрузки (максимум 2000)

## Примеры использования

### Базовый поиск
```
GET /search?keywords=python%20разработчик&region=2019&total=20
```

### Поиск с фильтрами зарплаты
```
GET /search?keywords=python%20разработчик&region=2019&salary_from=100000&salary_to=300000&currency=RUR&total=20
```

### Поиск с фильтрами опыта
```
GET /search?keywords=python%20разработчик&region=2019&experience=between1And3&experience=between3And6&employment=full&total=20
```

### Поиск с текстовыми параметрами
```
GET /search?keywords=python%20разработчик&region=2019&text_logic=all&text_field=skills&order_by=relevance&total=20
```

### Поиск с дополнительными фильтрами
```
GET /search?keywords=python%20разработчик&region=2019&age_from=25&age_to=35&gender=male&job_search_status=active_search&period=30&total=20
```

## Ограничения

1. **Глубина результатов**: Не более 2000 резюме
2. **Размер страницы**: Не более 100 резюме на страницу
3. **Обязательные параметры**: keywords и region
4. **Валидация**: Все параметры проходят валидацию на стороне сервера

## Техническая реализация

### Изменения в коде

1. **templates/search.html** - Расширенная форма поиска с новыми полями
2. **app.py** - Обновленная логика обработки параметров поиска
3. **data_manager/main.py** - Расширенный метод search_resumes
4. **data_manager/search_engine.py** - Обновленный метод search
5. **api/hh/main.py** - Расширенный метод get_all_resumes

### Архитектура

```
Форма поиска (search.html)
    ↓
Flask роут (/search)
    ↓
DataManager.search_resumes()
    ↓
SearchEngine.search()
    ↓
HHApiClient.get_all_resumes()
    ↓
HeadHunter API
```

## Тестирование

Для тестирования новой функциональности создан скрипт `test_extended_search.py`, который проверяет:

1. Отображение формы с новыми полями
2. Работу базового поиска
3. Фильтры по зарплате
4. Фильтры по опыту
5. Текстовые параметры
6. Дополнительные фильтры
7. Метки

Запуск тестов:
```bash
python test_extended_search.py
```

## Совместимость

Новая функциональность полностью совместима с существующим API. Все старые параметры продолжают работать, новые параметры являются опциональными.

## Планы развития

1. Добавление поддержки дополнительных параметров (языки, навыки, etc.)
2. Кэширование результатов поиска
3. Сохранение поисковых запросов
4. Экспорт результатов в различных форматах
5. Интеграция с другими источниками данных (Avito, SuperJob, etc.) 